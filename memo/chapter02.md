## 第02章 認証機能の追加
開発を始めようとする際 公開されているソリューションや標準規格の有無を確認し 利用できないか検討する  

### この章でやること
- Decorator パターンに基づいて http.Handler 型をラップし 機能を追加  
- 動的パスで HTTP エンドポイントを提供  
- オープンソースの　Gomniauth プロジェクトを利用して 認証サービスにアクセス  
- http パッケージを利用して Cookie の読み書き  
- Base64 形式を使って オブジェクトのエンコードとデコード  
- WebSocket 上で JSON データの送受信  
- さまざまな種類のデータをテンプレートに渡す  
- 自分で定義した型のチャネルを定義して利用  

### 内容
認証のミドルウェア(`ServeHTTP()` を持った struct)を作って 経由させる感じ  
認証の Cookie が存在しなければ リダイレクトさせる  
パスを split して swith したら 必ず パラメータが存在する(`/auth/{action}/{provider}`)前提になっていることに注意  
ちゃんとエラーハンドリングしないと 異常終了する  

## OAuth2
OAuth2 とは 認証と権限付与のためのオープンな標準規格  
リソース所有者が第三者に対して データアクセス権限を移譲する仕組み  

ユーザー視点の流れ
1. ユーザーはクライアントアプリへのログインに利用する認証プロバイダーを選ぶ  
クライアントアプリ = 自作アプリ, 認証プロバイダー = Twitter など  
2. ユーザーは その認証プロバイダーの Web サイトにリダイレクト  
リダイレクト先の URL には クライアントアプリのの ID 値が含まれる  
ユーザーは クライアントアプリ によるアクセス許可をするか尋ねられる  
3. ユーザーは認証プロバイダーにログインし クライアントアプリから求められるアクセスを許可  
4. ユーザーはクライアントアプリへ再びリダイレクトされる  
そのとき 認可コードを含む  
5. 内部で クライアントアプリは認証プロバイダーに認可コードを送信  
認証プロバイダー はアクセストークンを返す  
6. クライアントアプリは アクセストークンを含む認証済みのリクエストを行い ユーザー情報などを取得  

細かい部分は 認証プロバイダー次第だが  
セキュリティのために リクエスト元 URL を限定するために 事前に認証プロバイダーに登録する場合もあるらしい  

デジタル署名を行うと 第三者による改ざんを防げる  

### 参考文献
[OAuth 2.0 クライアント認証](https://qiita.com/TakahikoKawasaki/items/63ed4a9d8d6e5109e401)  


### 気になること
Cookie が存在しないかの定数に `http.ErrNoCookie` がある?  
リダイレクトに `http.StatusTemporaryRedirect` がある?  
ステータスコード404専用の `http.StatusNotFound` 定数がある?  
